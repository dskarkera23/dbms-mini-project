{% extends 'base.html' %}
{% block content %}
<style>
    .bmi-condition {
    font-weight: bold;
    padding: 4px 10px;
    }

    .bmi-condition.underweight {
        background-color: blue;
        color: white;
    }

    .bmi-condition.healthyweight {
        background-color: green;
        color: white;
    }

    .bmi-condition.overweight {
        background-color: yellow;
        color: black;
    }

    .bmi-condition.obesity {
        background-color: red;
        color: white;
    }

</style>
<div class="page-header">
                 <div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title">BMI Graph</h5>
            </div>
            <div class="card-body">
                <div class="card-body">
                    <canvas id="bmiChart" width="400" height="200"></canvas>
                </div>

            </div>
        </div>
    </div>

    <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">BMI Condition</h5>
                </div>
                <div class="card-body">
                    {% if latest_bmi %}
                        <p>Current BMI: {{ latest_bmi }}</p>
                        <p>BMI Condition: <span class="bmi-condition">{{ bmi_condition|lower }}</span></p>
                    {% else %}
                        <p>No BMI records available.</p>
                    {% endif %}
                </div>
            </div>
    </div>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var ctx = document.getElementById('bmiChart').getContext('2d');

        // Make an AJAX request to the backend
        fetch('/get_bmi_graph_data/')
            .then(response => response.json())
            .then(data => {
                var bmiData = {
                    labels: data.log_dates,
                    datasets: [{
                        label: 'BMI',
                        data: data.bmi_values,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: true
                    }]
                };

                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: bmiData,
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Update the BMI condition dynamically
                var bmiConditionElement = document.querySelector('.bmi-condition');
                if (bmiConditionElement && data.latest_bmi_condition) {
                    var conditionClass = data.latest_bmi_condition.toLowerCase().replace(/\s+/g, '_');
                    bmiConditionElement.textContent = data.latest_bmi_condition;
                    bmiConditionElement.classList.add(conditionClass);
                } else {
                    console.error('Latest BMI condition not available.');
                }
            })
            .catch(error => console.error('Error fetching BMI data:', error));
    });
</script>




    {% endblock %}